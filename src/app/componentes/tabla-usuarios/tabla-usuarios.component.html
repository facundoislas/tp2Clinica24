<div class="tabla-usuarios-container">
  
  <h1 class="titulo-gestion">Gestión de Usuarios</h1>

  <!-- Filtros de Tipo de Usuario -->
  <div class="filtros-container">
    <button 
      [class.activo]="filtroActivo === 'todos'"
      (click)="cambiarFiltro('todos')"
      class="btn-filtro btn-todos">
      Todos ({{usuarios.length}})
    </button>
    <button 
      [class.activo]="filtroActivo === 'paciente'"
      (click)="cambiarFiltro('paciente')"
      class="btn-filtro btn-paciente">
      Pacientes ({{contarUsuariosPorTipo('paciente')}})
    </button>
    <button 
      [class.activo]="filtroActivo === 'especialista'"
      (click)="cambiarFiltro('especialista')"
      class="btn-filtro btn-especialista">
      Especialistas ({{contarUsuariosPorTipo('especialista')}})
    </button>
    <button 
      [class.activo]="filtroActivo === 'admin'"
      (click)="cambiarFiltro('admin')"
      class="btn-filtro btn-admin">
      Administradores ({{contarUsuariosPorTipo('admin')}})
    </button>
  </div>

  <!-- Tabla de Usuarios -->
  <div class="tabla-wrapper">
    <table class="tabla-usuarios-moderna">
      
      <!-- Encabezado de la Tabla -->
      <thead>
        <tr>
          <th class="th-first">Nombre</th>
          <th>Apellido</th>
          <th>Tipo</th>
          <th>Correo</th>
          <th>Obra Social</th>
          <th class="text-center">Estado</th>
          <th class="text-center">Acción</th>
          <th class="th-last">Especialidad/Clínica</th>
        </tr>
      </thead>

      <tbody>
        <!-- Filas dinámicas de usuarios -->
        <tr *ngFor="let user of usuariosFiltrados" class="fila-hover">
          <td [attr.data-label]="'Nombre'">{{user.nombre}}</td>
          <td [attr.data-label]="'Apellido'">{{user.apellido}}</td>
          <td [attr.data-label]="'Tipo'" >{{user.tipo}}</td>
          <td [attr.data-label]="'Correo'" class="email-cell">{{user.email}}</td>
          <td [attr.data-label]="'Obra Social'" >{{user.obraSocial || 'N/A'}}</td>
          
          <!-- Estado -->
          <td [attr.data-label]="'Estado'" class="text-center">
            <span *ngIf="user.tipo === 'especialista'" 
                  [class]="user.aprobado ? 'badge-habilitado' : 'badge-deshabilitado'">
              {{user.aprobado ? 'Habilitado' : 'Deshabilitado'}}
            </span>
            <span *ngIf="user.tipo !== 'especialista'" >
              N/A
            </span>
          </td>
          
          <!-- Acción -->
          <td [attr.data-label]="'Acción'" class="text-center acciones-cell">
            <!-- Solo mostrar botones para especialistas -->
            <button *ngIf="user.tipo === 'especialista' && user.aprobado" 
                    (click)="deshabilitarEspecialista(user)"
                    class="btn-accion btn-deshabilitar">
              Deshabilitar
            </button>
            <button *ngIf="user.tipo === 'especialista' && !user.aprobado" 
                    (click)="habilitarEspecialista(user)"
                    class="btn-accion btn-habilitar">
              Habilitar
            </button>
            <span *ngIf="user.tipo !== 'especialista'" >N/A</span>
          </td>
          
          <!-- Especialidad/Historia Clínica -->
          <td [attr.data-label]="'Especialidad/Clínica'">
            <button *ngIf="user.tipo == 'paciente'" 
                    class="btn-historia" 
                    (click)="seleccionarPaciente(user.email)">
              Ver Historia Clínica
            </button>
            <span *ngIf="user.tipo === 'especialista'" class="especialidades-text">
              {{getEspecialidades(user)}}
            </span>
            <span *ngIf="user.tipo === 'admin'" class="admin-text">
              Administrador
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  

</div>
